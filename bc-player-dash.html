---
layout: default
---
<h1>Brightcove Player: Dash</h1>

<section class="bootstrap-iso">
<form id="playform">
  <div class="form-group">
    <label for="manifest">MPEG DASH Manifest:</label>
    <input type="text" class="form-control" id="manifest" name="manifest">
  </div>
  <div class="form-group">
    <label for="widevine-url">Widevine License URL: (Optional)</label>
    <input type="text" class="form-control" id="widevine-url" name="manifest">
  </div>
  <div class="form-group">
    <label for="bcov-auth">BCOV Auth JWT: (Optional)</label>
    <input type="text" class="form-control" id="bcov-auth" name="manifest">
    <div id="bcov-auth-alert" role="alert" hidden></div>
  </div>
  <button type="submit" class="btn btn-primary btn-lg">Play!</button><br><br>
  <button type="button" id="demo" class="btn btn-info btn-sm">Load Demo Manifest</button>
</form>
</section>

<section>
  <video-js
    id="example"
    data-account="4590388345001"
    data-player="3d0HFahKY"
    data-embed="default" controls=""
    data-application-id=""
    width="600" height="300">
  </video-js>
  <script
    src="//players.brightcove.net/4590388345001/3d0HFahKY_default/index.min.js">
  </script>
</section>

<p>This player is The Brightcove Player with all DRM enabled.<br><a href="https://www.brightcove.com/en/online-video-platform/video-player">More details can be found here.</a></p>
<p><small>This should play CENC content everywhere, using the Brightcove special sauce for setting license URLs, <a href="http://docs.brightcove.com/en/video-cloud/brightcove-player/guides/dash-drm.html">as documented here.</a></small></p>

<script>
const customGetLicense = (keySystemOptions) => (emeOptions, keyMessage, callback) => {
  const auth_alert = document.getElementById('bcov-auth-alert');
  const headers = mergeAndRemoveNull(
    {'Content-type': 'application/octet-stream'},
    emeOptions.emeHeaders,
    keySystemOptions.licenseHeaders
  );

  videojs.xhr({
    uri: keySystemOptions.url,
    method: 'POST',
    responseType: 'arraybuffer',
    body: keyMessage,
    headers
  }, (err, response, responseBody) => {
    if (err) {
      auth_alert.className = 'alert alert-warning';
      auth_alert.innerHTML = 'Unknown Error';
      callback(err);
      return;
    }
    const jwt_valid = response.headers['bcov-jwt-validity'];
    if (!jwt_valid) {
      auth_alert.className = 'alert alert-warning';
      auth_alert.innerHTML = 'No bcov-jwt-validity Header Found';
    } else {
      auth_alert.className = jwt_valid == 'success' ? 'alert alert-success' : 'alert alert-danger';
      auth_alert.innerHTML = 'Brightcove JWT Validity: '+jwt_valid;
    }
    console.log(response.headers);
    callback(null, responseBody);
  });
};

const play = () => {
  var player = videojs('example');
  const auth_alert = document.getElementById('bcov-auth-alert'),
      manifest_url = document.getElementById('manifest').value,
      bcov_auth = document.getElementById('bcov-auth').value,
      widevine_url = document.getElementById('widevine-url').value;
  localStorage.setItem('manifest',manifest_url);
  localStorage.setItem('widevine_url',widevine_url);
  localStorage.setItem('bcov_auth',bcov_auth);
  auth_alert.hidden = !bcov_auth
  if (!auth_alert.hidden) {
    auth_alert.className = 'alert';
    auth_alert.innerHTML = '.....';
  }
  player.src({
    src: manifest_url,
    type: 'application/dash+xml',
    dashPreprocessing: true,
    emeHeaders: { 'BCOV-Auth': bcov_auth },
    keySystems: {
      'com.widevine.alpha': { getLicense: customGetLicense({ url: widevine_url }) },
    }
  });
  player.play();
}

window.onload = () => {
  const manifest     = document.getElementById('manifest'),
        widevine_url = document.getElementById('widevine-url'),
        bcov_auth = document.getElementById('bcov-auth');

  if (!!localStorage.getItem('manifest')) {
    manifest.value = localStorage.getItem('manifest');
  }
  if (!!localStorage.getItem('widevine_url')) {
    widevine_url.value = localStorage.getItem('widevine_url');
  }
  if (!!localStorage.getItem('bcov_auth')) {
    bcov_auth.value = localStorage.getItem('bcov_auth')
  }
  document.getElementById('playform').onsubmit = () => {
    play();
    return false;
  }
  document.getElementById('demo').onclick = () => {
    manifest.value = 'http://rdmedia.bbc.co.uk/dash/ondemand/testcard/1/client_manifest-events.mpd';
    play();
  };
};
</script>